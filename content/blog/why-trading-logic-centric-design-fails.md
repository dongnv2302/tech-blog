---
title: "なぜ売買ロジック中心の設計は壊れるのか"
date: 2025-12-29
tags: ["SystemDesign", "TradingBot", "Architecture", "AntiPattern"]
toc: true
---

## はじめに

自動売買システムを作る際、  
多くの場合「売買ロジック」が最初にあり、  
それを中心に実装が進みます。

最初は問題なく動いているように見えますが、  
長期運用を前提にすると、  
この設計は徐々に限界を迎えます。

本記事では、  
**なぜ売買ロジック中心の設計が壊れやすいのか**を  
システム設計の観点から整理します。

本記事では、具体的な実装やコードには触れず、  
設計思想そのものに焦点を当てます。

---

## 売買ロジック中心設計とは何か

売買ロジック中心の設計では、  
1つの処理が以下の責務を同時に担います。

- 売買判断（エントリー / エグジット）
- 注文実行
- ポジション状態管理
- エラー処理・リトライ
- 運用ロジック（BE・監視・強制終了）

判断・実行・状態が分離されていない状態です。

---

## なぜ最初は問題が起きないのか

初期段階では、

- 通貨ペアが少ない
- ロジックが単純
- エラー発生頻度が低い

ため、  
この構成でも「動いている」ように見えます。

しかし、  
これは**運用が短期間であることによる錯覚**です。

---

## 長期運用で必ず顕在化する問題

### 1. if 分岐が増え続ける

仕様追加はそのまま条件分岐の追加になります。  
処理の意図が追えなくなり、  
修正コストが急激に上がります。

---

### 2. 状態遷移が不明確になる

- 未エントリー
- 約定待ち
- ポジション保有
- 監視中

これらの状態がコード内に散在し、  
「今どの状態なのか」が分からなくなります。

---

### 3. テストができない

売買ロジックと API 実行が密結合なため、

- ロジック単体のテストが困難
- 再現テストができない
- 本番環境依存になる

結果として、  
コードは触れない存在になります。

---

### 4. 障害復旧ができない

- 再起動後、どこから再開すべきか分からない
- 中途半端な状態が残る
- 二重注文や取り残しが発生する

これはロジックの問題ではなく、  
**設計の問題**です。

---

## 問題の本質

売買ロジックは  
システム全体の中心に置くべき存在ではありません。

売買ロジックは  
**「判断を返すだけの存在」**であるべきです。

売買ロジックの良し悪しとは無関係に、  
責務が混在した設計そのものが問題になります。

---

## 長期運用に必要な視点

安定した運用には、以下の分離が不可欠です。

- 判断（Strategy）
- 実行（Execution）
- 状態（State）
- リスク管理（Risk）
- 外部依存（Exchange API）

売買ロジックは、  
状態を見て判断を返す役割に限定されるべきです。

---

## おわりに

売買ロジック中心の設計は、  
短期では機能します。

しかし、  
長期運用を前提とするシステムでは  
必ず限界が訪れます。

次回からは、
これらの設計思想を前提として、
長期運用を成立させるための
具体的な設計判断について整理していきます。