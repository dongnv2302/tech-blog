---
title: "Binance APIを使った自動売買システムの基本構成"
date: 2025-12-22
tags: ["Binance", "API", "TradingBot", "RiskManagement"]
toc: true
---

## はじめに

暗号資産取引所が提供する API を利用すれば、  
売買戦略を自動化すること自体はそれほど難しくありません。

しかし、長期間・安定的に稼働する自動売買システムを設計・運用するとなると、  
単純な売買ロジック以上に考慮すべき点が多く存在します。

本記事では、Binance Futures API を利用した  
実運用を前提とした自動売買システムの基本構成について、  
エンジニア視点で整理します。

> ※ 本記事はシステム設計に関する技術的な整理を目的としており、  
> 特定の投資判断や売買を推奨するものではありません。

---

## 自動売買システム全体の構成

本システムは、以下のような責務分離を意識して設計されています。

```text
Market Data (WebSocket)
        ↓
Strategy Engine
        ↓
Risk / Guard Layer
        ↓
Order Execution
        ↓
State & Logging
```
それぞれの役割を以下で簡単に説明します。

---

## 1. Market Data Layer（WebSocket）

価格データの取得には、REST API ではなく WebSocket を使用します。

### 採用理由

- 遅延が少ない  
- リアルタイム性が高い  
- 頻繁なポーリングによる API 制限を回避できる  

### 設計方針

本システムでは、  
1分足（`kline_1m`）の **確定タイミングのみ** を処理対象とし、  
未確定足（途中更新）は無視する設計としています。

### 目的

- ノイズを減らす  
- 再現性のある判断を行う  

---

## 2. Strategy Engine（売買ロジック層）

Strategy Engine の責務は非常に限定されています。

### 担当範囲

- 今はエントリー条件を満たしているか  
- LONG / SHORT のどちらか  

エントリー可否の判定のみを行い、  
実際の注文処理やリスク管理には関与しません。

### この分離によるメリット

- 戦略の差し替えが容易  
- テストモードでの検証が可能  
- ロジックの肥大化を防止  

---

## 3. Risk / Guard Layer（最重要）

実運用において、最も重要なのがこのレイヤーです。

### 主なチェック項目

- 既に同一シンボルのポジションが存在しないか  
- 残高・証拠金が十分か  
- Binance の **maxNotional** 制限を超えていないか  
- ゴミ注文（stale orders）が残っていないか  

### Binance Futures 特有の注意点

Binance Futures では、以下の制約が複雑に絡み合います。

- leverage  
- notional  
- minNotional  
- tickSize / stepSize  

このレイヤーを軽視すると、  
注文失敗や想定外のリスクにつながります。

---

## 4. Order Execution Layer（注文実行）

注文実行層では、以下を明確に分離して扱います。

- エントリー（Market）  
- Stop Loss（STOP_MARKET）  
- Take Profit（TAKE_PROFIT_MARKET）  

### 実運用で重視している点

- 注文失敗時のリトライ  
- ポジション未反映状態への対処  
- `closePosition=true` を用いた安全な決済  

「注文が通る前提」で書かれたコードは、  
実運用では必ず破綻します。

---

## 5. Break-Even / Time-based Exit

多くの自動売買では、  
「一定利益に達したら BE（建値）」という  
単純な設計が見られます。

### 本システムの設計方針

- 一定時間内に BE に到達しない場合は強制クローズ  
- BE 到達後は監視を終了  

このように **時間軸を考慮した BE 設計** を採用しています。

### 目的

- ダラダラとしたポジションを避ける  
- 市場の勢いが無い局面から撤退する  

---

## 6. State Management（状態管理）

取引所 API の状態だけに依存するのは危険です。

### 採用している対策

- ローカルファイルによる open position 管理  
- 再起動時の状態復元  
- 二重エントリー防止  

これは、  
**クラッシュや通信断は必ず起きる**  
という前提に基づいた設計です。

---

## 7. Logging & Traceability

ログは「デバッグ用」ではなく、  
**戦略改善のためのデータ資産**として扱います。

### 記録している主な情報

- エントリー理由ログ  
- 無効シグナルの記録  
- 最大利益・最大逆行の追跡  
- トレード結果の CSV 保存  

後から冷静に検証できる形を重視しています。

---

## おわりに

自動売買システムは、

**良い戦略 × 安定したシステム設計**

で初めて意味を持ちます。

戦略だけに注目し、  
システム設計を軽視すると、  
長期運用では必ず問題が顕在化します。

今後の記事では、

- テストモード設計  
- Notional 管理  
- Break-Even の考え方  
- WebSocket の落とし穴  

など、  
本システムの各要素を個別に掘り下げていく予定です。